---
title: "Guida Bayesiana per Autostoppisti"
subtitle: "SNACK SIPF 30/04/2021"
author: "Michele Scandola"
date: "NPSY-Lab.VR & BASIC-NPSY, UniVR"
font-family: 'Serif'
output:
  ioslides_presentation: 
    incremental: yes
    df_print: paged
    logo: logo.jpeg
css: mystyle.css
bibliography: biblio.bib
runtime: shiny
---

```{r setup, include=FALSE}
# Presentazione preparata da Michele Scandola per il webinar
# della Società Italiana di PsicoFisiologia e neuroscienze cognitive (SIPF)
# del 30 aprile 2021
# 
# Licenza afl-3.0

library(DT)
knitr::opts_chunk$set(echo = FALSE)
```

<div class="header">
  30/04/2021 $2^{nd}$ SNACK SIPF -
  Guida Bayesiana per Autostoppisti
</div>
<div class="footer">
  M. Scandola, NPsy-Lab.VR, Human Sciences Dept., UniVR
</div>

## Cosa è la statistica Bayesiana?

- Le origini: Bayes & Laplace
- $P(\theta|D) \propto P(D|\theta) \times P(\theta)$
- Distribuzione a priori $P(\theta)$ o $P(H)$:

  distribuzione di probabilità dell'ipotesi o dei parametri
  in forma di distribuzione dei dati.
  
  _Come credo saranno distribuiti i dati._
  
- Funzione di verosomiglianza (likelihood) $P(D|\theta)$ o $P(D|H)$:

  distribuzione di probabilità dei dati tramite modello.
  
  _Come sono realmente distribuiti i dati secondo la distribuzione scelta._
  
- Distribuzione a posteriori $P(\theta|D)$ o $P(H|D)$:

  distribuzione di probabilità dell'ipotesi o dei parametri dopo
  l'osservazione dei dati.
  
  _Come cambia la mia ipotesi di distribuzione dei dati, in seguito alla loro
   osservazione._
  
## Procedimento tipico


<div class="box" style="margin-left:5%;font-size:80%;">
- **Cosa mi aspetto?**

- Distribuzione a-priori.
- Una differenza di una certa dimensione (effect size).
- Nessuna ipotesi, priore non-informative o slightly informative.
  
* Grafico della distribuzione a priori!
</div>

<div class="box" style="margin-left:28%;font-size:80%;">
- **Cosa osservo?**

- Funzione di verosomiglianza.
- I dati modificano i parametri del modello matematico scelto
  (i $\beta$ di un modello lineare)
</div>

<div class="box" style="margin-left:50%;font-size:80%;">
- **Come cambia la mia aspettativa sui risultati, in seguito alle osservazioni?**

- Distribuzione a posteriori.
- Vedo che la differenza che mi attendevo è differente da quello
  che mi aspettavo. Il risultato è una sorta di "media pesata" fra la
  distribuzione a priori e la funzione di verosomiglianza.
</div>

## Un esempio 1/4 - modificato da [@Albert2009]

- Eseguiamo su un singolo partecipante un test composto
  da 30 prove diverse.

- Le prove sono abbastanza difficili, ma non sappiamo quanto.
  Ci aspettiamo un andamento 50/50

```{r, fig.height=3}
curve(dbeta(x,15+1,15+1),add=FALSE,
        lty=3,lwd=4, col = "green",
        xlab="percentuale di successo",
        ylab="Density", axes = FALSE)
abline(v = 15/30, col = "grey")
axis(side = 1, at = seq(from = 0, to = 1, by = 0.1),
       labels = paste0(seq(from = 0, to = 100, by = 10), "%"))
```

- Distribuzione a-priori $P(\theta) \sim \mathcal{B}(15+1,15+1)$

## Un esempio 2/4 - modificato da [@Albert2009]

- Per ogni prova eseguita
  abbiamo il dato di accuratezza (1 = successo, 0 = fallimento).

- Il nostro partecipante riesce in 10 prove, ma ne sbaglia 20.

```{r, fig.height=3}
successes <- 10##33%
failures  <- 20##77%
curve(dbeta(x,successes+1,failures+1),add=FALSE,lty=2,lwd=4,
        col = "blue",
        xlab="percentuale di successo",
        ylab="Density", axes = FALSE)
abline(v = 10/30, col = "red")
abline(v = 15/30, col = "grey")
axis(side = 1, at = seq(from = 0, to = 1, by = 0.1),
       labels = paste0(seq(from = 0, to = 100, by = 10), "%"))
```

- Funzione di verosomiglianza $P(D|\theta) \sim \mathcal{B}(10+1,20+1)$

## Un esempio 3/4 - modificato da [@Albert2009]

- Combinando la nostra aspettativa con i dati,
  la nostra aspettativa cambia...

```{r, fig.height=3}
successes <- 10##33%
failures  <- 20##77%
curve(dbeta(x,15+successes,15+failures), from=0, to=1,
        xlab="percentuale di successo",
        ylab="Density",lty=1,lwd=4, ylim = c(0,10),
        axes = FALSE, col = "red")
abline(v = 10/30, col = "red")
abline(v = 15/30, col = "grey")
axis(side = 1, at = seq(from = 0, to = 1, by = 0.1),
       labels = paste0(seq(from = 0, to = 100, by = 10), "%"))
```

- Distribuzione a posteriori $P(\theta|D) \sim \mathcal{B}(15+10,15+20)$

## Un esempio 4/4 - modificato da [@Albert2009]

```{r, fig.height=1}
renderPlot({
  a0 <- as.numeric(input$a)
  b0 <- 30 - a0
  
  successes <- 10##33%
  failures  <- 20##77%
  
  ## posterior
  curve(dbeta(x,a0+successes,b0+failures), from=0, to=1,
        xlab="percentuale di successo",
        ylab="Density",lty=1,lwd=4, ylim = c(0,10),
        axes = FALSE, col = "red")
  ## likelihood
  curve(dbeta(x,successes+1,failures+1),add=TRUE,lty=2,lwd=4,
        col = "blue")
  ## prior
  curve(dbeta(x,a0,b0),add=TRUE,lty=3,lwd=4, col = "green")
  legend(.7,10,c("Prior","Likelihood","Posterior"),
         lty=c(3,2,1),lwd=c(3,3,3),col=c("green","blue","red"))
  axis(side = 1, at = seq(from = 0, to = 1, by = 0.1),
       labels = paste0(seq(from = 0, to = 100, by = 10), "%"))
})

inputPanel(
  sliderInput("a", label = "Distribuzione a-priori dei successi:",
              min = 0, max = 30, value = 15, step = 1)
)
```

## Una diversa concezione della probabilità

<div class="columns-2">
  **Frequentista**

  - i parametri delle distribuzioni sono fissi, sono i dati casuali
  
  - si basa sull'assunto che l'ipotesi nulla sia vera
    
  - p-value ($P_\theta(X = x)$) 
    rappresenta quanto è raro ottenere il campione osservato
    da una popolazione statistica sotto $H_0$
    
  - l'intervallo di _confidenza_ del 95% indica che la reale media del campione è nel CI il 95% delle volte


  **Bayesiana**
  
  - i dati sono fissi, i parametri delle distribuzioni sono variabili
  
  - ogni ipotesi può avere una diversa probabilità
  
  - la probabilità rappresenta la credibilità che ha una certa
    ipotesi o certi parametri delle distribuzioni
    *ossia, rappresenta l'incertezza verso una ipotesi o un parametro*
    
  - l'intervallo di _credibilità_ o HDI del 95% indica che il 95% della popolazione è nel CI
  
</div>

## Diversi metodi 

```{r}

dat <- data.frame(
  y = rnorm(100),
  x = rgamma(100, shape = 1)
)

datatable( dat , options = list(
  pageLength = 8
))

```

## Bayes Factor: Savage-Dickey density ratio

```{r, fig.height=1}
renderPlot({
  mean_prior <- as.numeric(input$mp)
  var_prior  <- as.numeric(input$vp)
  
  mean_lik  <- 20
  var_lik   <- 5
  
  var_post  <- 1/(1/var_prior + 1/var_lik)
  mean_post <- ((1/var_prior)/(1/var_post)) * mean_prior +
    ((1/var_lik)/(1/var_post)) * mean_lik
  
  ## posterior
  curve(dnorm(x,mean_post,sqrt(var_post)), from=0, to=40,
        xlab="Punteggio medio",
        ylab="Density",lty=1,lwd=4, ylim = c(0,0.4),
        axes = FALSE, col = "red",
        main = paste("BF10 =",
                              round(
                                  dnorm(mean_prior,mean_prior,sqrt(var_prior))/
                                  dnorm(mean_prior,mean_post,sqrt(var_post)),
                                2),
                     " BF01 =",
                              round(
                                dnorm(mean_prior,mean_post,sqrt(var_post))/
                                  dnorm(mean_prior,mean_prior,sqrt(var_prior)),
                                2)
                     )
        )
  ## likelihood
  curve(dnorm(x,mean_lik,sqrt(var_lik)),add=TRUE,lty=2,lwd=4,
        col = "blue")
  ## prior
  curve(dnorm(x,mean_prior,sqrt(var_prior)),add=TRUE,lty=3,lwd=4, col = "green")
  legend(.7,10,c("Prior","Likelihood","Posterior"),
         lty=c(3,2,1),lwd=c(3,3,3),col=c("green","blue","red"))
  axis(side = 1, at = seq(from = 0, to = 30, by = 1))
  abline( v = mean_prior, col = "purple")#line for my "zero"
  points(x = mean_prior, y = dnorm(mean_prior,mean_prior,sqrt(var_prior)),
         pch = 19 )
  points(x = mean_prior, y = dnorm(mean_prior,mean_post,sqrt(var_post)),
         pch = 19 )
})

inputPanel(
  sliderInput("vp", label = "Modifica della varianza del priore:",
              min = 1, max = 30, value = 5, step = 1),
  sliderInput("mp", label = "Modifica della media del priore:",
              min = 1, max = 30, value = 15, step = 1)
)
```

## References
